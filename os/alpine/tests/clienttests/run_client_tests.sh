#!/bin/sh

## INIT - DEFINE CLIENT SYSTEM NAMES
CONSUMER_SYSTEM_NAME="alpine1consumer"
PROVIDER_SYSTEM_NAME="alpine1provider"

## STEP 0 --- INITIALIZE DIRECTORIES
mkdir $CONSUMER_SYSTEM_NAME
mkdir $PROVIDER_SYSTEM_NAME

## STEP 1 --- REQUEST A CERTIFICATE FOR THE CONSUMER SYSTEM
$PWD/clienttools/requestCertificate.sh $CONSUMER_SYSTEM_NAME  

## STEP 2 --- USE MANAGEMENT TOOL TO REGISTER SYSTEM 

## STEP 2 a --- GET NORMALIZED PUBLIC KEY 
## FOR AUTHINFO PARAM OF SYSTEM REGISTRATION
CONSUMER_AUTHINFO="$( cat $PWD/$CONSUMER_SYSTEM_NAME/$CONSUMER_SYSTEM_NAME.pub.authinfo)"

## STEP 2 b --- CALL MANAGEMENT TOOLS SYSTEM REGISTRATION
cd ./managementtool
$PWD/register_system.sh "${CONSUMER_SYSTEM_NAME}" "${CONSUMER_AUTHINFO}" 
cd ../

## STEP 3 --- REQUEST a CERTIFICATE FOR THE PROVIDER SYSTEM
$PWD/clienttools/requestCertificate.sh $PROVIDER_SYSTEM_NAME  

## STEP 4 --- REGISTER SERVICE / AND PROVIDER SYSTEM

